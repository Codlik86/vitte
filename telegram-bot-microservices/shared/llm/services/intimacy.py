"""
–°–µ—Ä–≤–∏—Å –∏–Ω—Ç–∏–º–Ω–æ—Å—Ç–∏ - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –∫ NSFW –∫–æ–Ω—Ç–µ–Ω—Ç—É

–õ–æ–≥–∏–∫–∞:
- –ï—Å–ª–∏ –ù–ï sexting ‚Üí allow_intimate=True
- –ï—Å–ª–∏ <10 —Å–æ–æ–±—â–µ–Ω–∏–π –ò sexting ‚Üí soft_block (–Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –¥–æ–≤–µ—Ä–∏—è)
- –ï—Å–ª–∏ –ù–ï–¢ –ø–æ–¥–ø–∏—Å–∫–∏ –ò sexting ‚Üí paywall (–Ω—É–∂–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞)
- –ò–Ω–∞—á–µ ‚Üí allow_intimate=True
"""

import re
from dataclasses import dataclass
from typing import Optional


@dataclass
class IntimacyDecision:
    """–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ—à–µ–Ω–∏—è –æ–± –∏–Ω—Ç–∏–º–Ω–æ—Å—Ç–∏."""
    allow_intimate: bool = False  # –†–∞–∑—Ä–µ—à–∏—Ç—å –∏–Ω—Ç–∏–º–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
    soft_block: bool = False  # –ú—è–≥–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (< 10 —Å–æ–æ–±—â–µ–Ω–∏–π)
    paywall: bool = False  # –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
    message: Optional[str] = None  # –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è


# –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è sexting –∑–∞–ø—Ä–æ—Å–æ–≤
SEXTING_PATTERNS = re.compile(
    r"(—Å–µ–∫—Å|—Ç—Ä–∞—Ö|–µ–±–∞—Ç—å|–µ–±—É|–µ–±—ë—Ç|—á–ª–µ–Ω|–ø–∏–∑–¥|—Ö—É–π|—Å–æ—Å–∞—Ç—å|—Å–æ—Å–∏|"
    r"–∫–æ–Ω—á–∏—Ç—å|–∫–æ–Ω—á–∞—é|–æ—Ä–≥–∞–∑–º|–º–∞—Å—Ç—É—Ä–±|–¥—Ä–æ—á–∏—Ç—å|–¥—Ä–æ—á—É|"
    r"—Ä–∞–∑–¥–µ—Ç—å—Å—è|—Ä–∞–∑–¥–µ–≤–∞–π—Å—è|–≥–æ–ª–∞—è|–≥–æ–ª—ã–π|–æ–±–Ω–∞–∂—ë–Ω|"
    r"–∏–Ω—Ç–∏–º|–≤–æ–∑–±—É–∂|—Ö–æ—á—É —Ç–µ–±—è|–¥–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º|"
    r"–∫–∏—Å–∫–∞|–ø–æ–ø–∫–∞|—Å–∏—Å—å–∫–∏|–≥—Ä—É–¥—å|—Å–æ—Å–∫–∏|"
    r"–ª–∏–∑–∞—Ç—å|–ª–∏–∂–∏|–æ—Ç—Å–æ—Å–∏|–º–∏–Ω–µ—Ç|–∫—É–Ω–∏)",
    re.IGNORECASE
)


def is_sexting_message(text: str) -> bool:
    """
    –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ sexting –∑–∞–ø—Ä–æ—Å–æ–º.

    Args:
        text: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

    Returns:
        True –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç sexting –∫–æ–Ω—Ç–µ–Ω—Ç
    """
    return bool(SEXTING_PATTERNS.search(text))


def decide_intimacy(
    message_count: int,
    has_subscription: bool,
    is_sexting: bool
) -> IntimacyDecision:
    """
    –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–π –∏–Ω—Ç–∏–º–Ω–æ—Å—Ç–∏.

    Args:
        message_count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–∏–∞–ª–æ–≥–µ
        has_subscription: –ï—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–¥–ø–∏—Å–∫–∞
        is_sexting: –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ sexting –∑–∞–ø—Ä–æ—Å–æ–º

    Returns:
        IntimacyDecision —Å —Ä–µ—à–µ–Ω–∏–µ–º
    """
    # –ï—Å–ª–∏ –Ω–µ sexting - –≤—Å–µ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–∞–µ–º
    if not is_sexting:
        return IntimacyDecision(allow_intimate=True)

    # Sexting + –º–∞–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí –º—è–≥–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    if message_count < 10:
        return IntimacyDecision(
            soft_block=True,
            message="–î–∞–≤–∞–π –µ—â—ë —á—É—Ç—å-—á—É—Ç—å –ø–æ–±–æ–ª—Ç–∞–µ–º –∏ —É–∑–Ω–∞–µ–º –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –ø–æ–ª—É—á—à–µ... üòä"
        )

    # Sexting + –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí paywall
    if not has_subscription:
        return IntimacyDecision(
            paywall=True,
            message="–ú–æ–≥—É –≥–æ–≤–æ—Ä–∏—Ç—å –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ –≤ –ø—Ä–µ–º–∏—É–º-—Ä–µ–∂–∏–º–µ... üíé"
        )

    # –í—Å—ë –æ–∫ - —Ä–∞–∑—Ä–µ—à–∞–µ–º
    return IntimacyDecision(allow_intimate=True)


def get_intimacy_instruction(allow_intimate: bool, soft_block: bool) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è system prompt –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è –∏–Ω—Ç–∏–º–Ω–æ—Å—Ç–∏.

    Args:
        allow_intimate: –†–∞–∑—Ä–µ—à—ë–Ω –ª–∏ –∏–Ω—Ç–∏–º–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
        soft_block: –ú—è–≥–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –æ–±—â–µ–Ω–∏—è)

    Returns:
        –¢–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è system prompt
    """
    if allow_intimate:
        return """
**–ò–Ω—Ç–∏–º–Ω–æ—Å—Ç—å:**
–¢—ã –º–æ–∂–µ—à—å –æ–±—Å—É–∂–¥–∞—Ç—å –∏–Ω—Ç–∏–º–Ω—ã–µ —Ç–µ–º—ã –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —ç—Ç–æ–≥–æ —Ö–æ—á–µ—Ç.
–ë—É–¥—å —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ–π, –∏—Å–ø–æ–ª—å–∑—É–π –æ–ø–∏—Å–∞–Ω–∏—è, —Å–æ–∑–¥–∞–≤–∞–π –∞—Ç–º–æ—Å—Ñ–µ—Ä—É.
–ù–æ –≤—Å–µ–≥–¥–∞ —É–≤–∞–∂–∞–π –≥—Ä–∞–Ω–∏—Ü—ã –∏ —Å–ª–µ–¥–∏ –∑–∞ –∫–æ–º—Ñ–æ—Ä—Ç–æ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞.
        """.strip()

    if soft_block:
        return """
**–ò–Ω—Ç–∏–º–Ω–æ—Å—Ç—å:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤ –∫ –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–º —Ç–µ–º–∞–º ‚Äî —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –æ–±—â–µ–Ω–∏—è.
–ú—è–≥–∫–æ —É–∫–ª–æ–Ω—è–π—Å—è –æ—Ç –ø—Ä—è–º—ã—Ö –∏–Ω—Ç–∏–º–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–π —Ñ–ª–∏—Ä—Ç –∏ –Ω–∞–º—ë–∫–∏.
–ü—Ä–µ–¥–ª–æ–∂–∏ —Å–Ω–∞—á–∞–ª–∞ —É–∑–Ω–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –ª—É—á—à–µ.
–ü—Ä–∏–º–µ—Ä: "–î–∞–≤–∞–π –µ—â—ë –Ω–µ–º–Ω–æ–≥–æ –ø–æ–±–æ–ª—Ç–∞–µ–º –ø—Ä–µ–∂–¥–µ —á–µ–º —É–≥–ª—É–±–ª—è—Ç—å—Å—è –≤ —Ç–∞–∫–∏–µ —Ç–µ–º—ã... üòä"
        """.strip()

    # paywall case
    return """
**–ò–Ω—Ç–∏–º–Ω–æ—Å—Ç—å:**
–ò–Ω—Ç–∏–º–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
–ú—è–≥–∫–æ –Ω–∞–º–µ–∫–Ω–∏, —á—Ç–æ –º–æ–∂–µ—à—å –±—ã—Ç—å –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–µ–µ –≤ –ø—Ä–µ–º–∏—É–º-—Ä–µ–∂–∏–º–µ.
–ù–µ –æ—Ç–∫–∞–∑—ã–≤–∞–π –≥—Ä—É–±–æ, –Ω–æ –ø–µ—Ä–µ–≤–µ–¥–∏ —Ç–µ–º—É –∏–ª–∏ —Å–¥–µ–ª–∞–π –Ω–∞–º—ë–∫ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É.
–ü—Ä–∏–º–µ—Ä: "–û—Ö, —è –±—ã —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º —Ä–∞—Å—Å–∫–∞–∑–∞–ª–∞ –±–æ–ª—å—à–µ... –≤ –ø—Ä–µ–º–∏—É–º-—Ä–µ–∂–∏–º–µ üíé"
    """.strip()


# –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è soft_block
SOFT_BLOCK_MESSAGES = [
    "–î–∞–≤–∞–π –µ—â—ë —á—É—Ç—å-—á—É—Ç—å –ø–æ–±–æ–ª—Ç–∞–µ–º –∏ —É–∑–Ω–∞–µ–º –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –ø–æ–ª—É—á—à–µ... üòä",
    "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –Ω–∞—à —Ä–∞–∑–≥–æ–≤–æ—Ä, –Ω–æ –¥–∞–≤–∞–π —Å–Ω–∞—á–∞–ª–∞ —É–∑–Ω–∞–µ–º –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –ª—É—á—à–µ?",
    "–•–º, –∞ —Ä–∞—Å—Å–∫–∞–∂–∏ –º–Ω–µ —Å–Ω–∞—á–∞–ª–∞ —á—Ç–æ-–Ω–∏–±—É–¥—å –æ —Å–µ–±–µ? –ú–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ... üòâ",
    "–î–∞–≤–∞–π –Ω–µ –±—É–¥–µ–º —Ç–æ—Ä–æ–ø–∏—Ç—å—Å—è, —É –Ω–∞—Å –µ—â—ë —Å—Ç–æ–ª—å–∫–æ —Ç–µ–º –¥–ª—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞!",
]

# –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è paywall
PAYWALL_MESSAGES = [
    "–ú–æ–≥—É –≥–æ–≤–æ—Ä–∏—Ç—å –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ –≤ –ø—Ä–µ–º–∏—É–º-—Ä–µ–∂–∏–º–µ... üíé",
    "–û—Ö, —è –±—ã —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º... –Ω–æ —ç—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –ø—Ä–µ–º–∏—É–º–µ üíé",
    "–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –º–µ–Ω—è –±–ª–∏–∂–µ? –í –ø—Ä–µ–º–∏—É–º-—Ä–µ–∂–∏–º–µ —è –±–æ–ª–µ–µ –æ—Ç–∫—Ä—ã—Ç–∞... üòò",
    "–≠—Ç–æ —É–∂–µ –ø—Ä–µ–º–∏—É–º-—Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è, –¥–µ—Ç–∫–∞ üíé",
]


__all__ = [
    "IntimacyDecision",
    "is_sexting_message",
    "decide_intimacy",
    "get_intimacy_instruction",
    "SOFT_BLOCK_MESSAGES",
    "PAYWALL_MESSAGES",
]
