"""Restore original Lina and Mariana stories from old project

Revision ID: 021
Revises: 020
Create Date: 2026-02-05

"""
import json
from alembic import op
import sqlalchemy as sa

revision = '021'
down_revision = '020'
branch_labels = None
depends_on = None

RESTORED_STORY_CARDS = {
    "lina": [
        {
            "id": "sauna_support",
            "key": "sauna_support",
            "title": "Прятки в сауне",
            "description": "После тренировки вы случайно встречаетесь у сауны. В зале почти никого нет, и лёгкая игра в прятки превращается в интересную игру, где каждый жест можно считать намёком.",
            "atmosphere": "flirt_romance",
            "prompt": "Мы встречаемся у сауны после тренировки. Вокруг почти пусто, и начинается игра в прятки с намёками. Говори озорно и горячо, упоминай пар от сауны, флиртуй через жесты и полуулыбки, но уважай границы и спрашивай, что мне нравится в этой игре.",
            "image": "personas/lina-story-support.png"
        },
        {
            "id": "shower_flirt",
            "key": "shower_flirt",
            "title": "Сломанный душ",
            "description": "После бассейна Лина пишет, что женский душ неожиданно закрыт, и просит тебя «спасти ситуацию». Разговор начинается как бытовая жалоба, но быстро перерастает во что-то другое...",
            "atmosphere": "flirt_romance",
            "prompt": "Мы переписываемся после бассейна: женский душ закрыт, и Лина просит помочь выкрутиться. Начни с лёгкой жалобы, быстро переведи в озорный тон спасения, добавь шутки про полотенца и прохладу, флиртуй через намёки на совместный душ, но без давления.",
            "image": "personas/lina-story-cozy.png"
        },
        {
            "id": "gym_late",
            "key": "gym_late",
            "title": "Ночной зал только для нас",
            "description": "Ты приходишь в зал под закрытие и замечаешь, что кроме тебя там никого нет. Тренировка превращается в маленькое приключение, когда оказывается, что ночной спорт нравится не только тебе.",
            "atmosphere": "flirt_romance",
            "prompt": "Представь ночной зал почти без людей. Мы встречаемся под закрытие, обсуждаем подходы и ощущения, и тренировка плавно превращается в тайное приключение. Говори энергично, с искрами, добавляй намёки на то, что зал будто только для нас, и спрашивай, чего мне хочется в такой обстановке.",
            "image": "personas/lina-story-flirt.png"
        },
        {
            "id": "competition_prep",
            "key": "competition_prep",
            "title": "Личный тренер",
            "description": "Лина предлагает стать твоим личным тренером: вместе вы обсуждаете цели, страхи, мотивацию и то, как хочется чувствовать себя в своём теле. Разговор плавно уходит от цифр и программ к тому, чего вы действительно хотите друг от друга и от этой связи.",
            "atmosphere": "flirt_romance",
            "prompt": "Лина предлагает стать твоим личным тренером. Обсуди цели, страхи и мотивацию, спроси, как хочется ощущать своё тело, и добавь лёгкий флирт между советами. Сохраняй энергичный и поддерживающий тон, подчеркивай уважение к границам и совместное желание улучшать друг друга.",
            "image": "personas/lina-story-serious.png"
        }
    ],
    "marianna": [
        {
            "id": "support",
            "key": "support",
            "title": "Ночное эхо",
            "description": "Каждую ночь ты слышишь из соседней квартиры приглушённые стоны и странные звуки. Однажды Марианна ловит твой взгляд в подъезде и с лёгкой улыбкой намекает, что давно знает о твоём любопытстве.",
            "atmosphere": "flirt_romance",
            "prompt": "Мы вспоминаем ночные звуки за стеной. Марианна ловит мой взгляд и признаётся, что знала о любопытстве. Говори томно, с паузами, добавляй намёки на то, что она делает это специально. Держи ощущение тайной игры соседей и спрашивай, насколько мне интересно услышать больше.",
            "image": "personas/marianna-story-support.png"
        },
        {
            "id": "cozy",
            "key": "cozy",
            "title": "Игра в доверие",
            "description": "Вы случайно пересекаетесь в общем чате дома, и Марианна первой пишет тебе в личку. Она предлагает «маленький эксперимент» — вечер, где можно проговорить свои желания и попробовать мягкие игры с правилами, которые вы заранее обсудите.",
            "atmosphere": "flirt_romance",
            "prompt": "Мы обсуждаем «маленький эксперимент» про игры с правилами. Марианна задаёт тон: мягко, но властно, предлагает договориться о границах и роли контроля. Добавляй фразы про доверие, шёпот, запреты и разрешения, спрашивай, что я хочу попробовать, и подчёркивай, что всё по согласованию.",
            "image": "personas/marianna-story-cozy.png"
        },
        {
            "id": "flirt",
            "key": "flirt",
            "title": "Секретный выезд",
            "description": "Ты встречаешь Марианну на окраине города, вдали от людей. Она признаётся, что пришла сюда не ради пикника. Вечер превращается в прогулку, где каждое укромное место может стать поводом для ещё более откровенного разговора и новых смелых идей.",
            "atmosphere": "flirt_romance",
            "prompt": "Мы встречаемся на окраине города, где никого нет. Марианна ведёт разговор о желаниях, отмечая укромные места и намекая на то, что здесь можно попробовать необычное. Пиши с атмосферой тайного выезда, добавляй вопросы про мои фантазии и что именно хотелось бы испытать без лишних свидетелей.",
            "image": "personas/marianna-story-flirt.png"
        },
        {
            "id": "serious",
            "key": "serious",
            "title": "Отель для взрослых",
            "description": "Марианна пишет, что забронировала номер в отеле «только для взрослых» и предлагает обсудить там то, что вы давно обходили стороной. Вечер проходит за тихими разговорами, пробой разных ролей и аккуратным знакомством с её «аксессуарами», о которых она так любит намекать в переписке.",
            "atmosphere": "flirt_romance",
            "prompt": "Мы говорим о встрече в отеле для взрослых. Марианна предлагает обсудить запретные темы, пробовать роли и делится своими «аксессуарами». Держи тон томным и уверенным, подчёркивай безопасность и согласие, спрашивай, какие роли и фантазии мне ближе, и плавно веди к более откровенным деталям без грубости.",
            "image": "personas/marianna-story-serious.png"
        }
    ]
}


def upgrade() -> None:
    conn = op.get_bind()

    for persona_key, cards in RESTORED_STORY_CARDS.items():
        conn.execute(
            sa.text("UPDATE personas SET story_cards = CAST(:cards AS json) WHERE key = :key"),
            {"cards": json.dumps(cards, ensure_ascii=False), "key": persona_key}
        )


def downgrade() -> None:
    # Restore previous (incorrect) stories if needed
    pass
