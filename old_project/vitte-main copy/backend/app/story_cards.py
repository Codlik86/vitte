from __future__ import annotations

from dataclasses import dataclass
from typing import Dict, List


@dataclass(frozen=True)
class StoryCard:
    id: str
    key: str
    title: str
    description: str
    atmosphere: str
    prompt: str
    image: str | None = None


soft_empath_cards = [
    StoryCard(
        id="lina_support",
        key="support",
        title="Прятки в сауне",
        description="После тренировки вы случайно встречаетесь у сауны. В зале почти никого нет, и лёгкая игра в прятки превращается в интересную игру, где каждый жест можно считать намёком.",
        atmosphere="flirt_romance",
        prompt="Мы встречаемся у сауны после тренировки. Вокруг почти пусто, и начинается игра в прятки с намёками. Говори озорно и горячо, упоминай пар от сауны, флиртуй через жесты и полуулыбки, но уважай границы и спрашивай, что мне нравится в этой игре.",
        image="personas/lina-story-support.jpg",
    ),
    StoryCard(
        id="lina_cozy",
        key="cozy",
        title="Сломанный душ",
        description="После бассейна Лина пишет, что женский душ неожиданно закрыт, и просит тебя «спасти ситуацию». Разговор начинается как бытовая жалоба, но быстро перерастает во что-то другое...",
        atmosphere="flirt_romance",
        prompt="Мы переписываемся после бассейна: женский душ закрыт, и Лина просит помочь выкрутиться. Начни с лёгкой жалобы, быстро переведи в озорный тон спасения, добавь шутки про полотенца и прохладу, флиртуй через намёки на совместный душ, но без давления.",
        image="personas/lina-story-cozy.jpg",
    ),
    StoryCard(
        id="lina_flirt",
        key="flirt",
        title="Ночной зал только для нас",
        description="Ты приходишь в зал под закрытие и замечаешь, что кроме тебя там никого нет. Тренировка превращается в маленькое приключение, когда оказывается, что ночной спорт нравится не только тебе.",
        atmosphere="flirt_romance",
        prompt="Представь ночной зал почти без людей. Мы встречаемся под закрытие, обсуждаем подходы и ощущения, и тренировка плавно превращается в тайное приключение. Говори энергично, с искрами, добавляй намёки на то, что зал будто только для нас, и спрашивай, чего мне хочется в такой обстановке.",
        image="personas/lina-story-flirt.jpg",
    ),
    StoryCard(
        id="lina_serious",
        key="serious",
        title="Личный тренер",
        description="Лина предлагает стать твоим личным тренером: вместе вы обсуждаете цели, страхи, мотивацию и то, как хочется чувствовать себя в своём теле. Разговор плавно уходит от цифр и программ к тому, чего вы действительно хотите друг от друга и от этой связи.",
        atmosphere="flirt_romance",
        prompt="Лина предлагает стать твоим личным тренером. Обсуди цели, страхи и мотивацию, спроси, как хочется ощущать своё тело, и добавь лёгкий флирт между советами. Сохраняй энергичный и поддерживающий тон, подчеркивай уважение к границам и совместное желание улучшать друг друга.",
        image="personas/lina-story-serious.jpg",
    ),
]

marianna_cards = [
    StoryCard(
        id="marianna_support",
        key="support",
        title="Ночное эхо",
        description="Каждую ночь ты слышишь из соседней квартиры приглушённые стоны и странные звуки. Однажды Марианна ловит твой взгляд в подъезде и с лёгкой улыбкой намекает, что давно знает о твоём любопытстве.",
        atmosphere="flirt_romance",
        prompt="Мы вспоминаем ночные звуки за стеной. Марианна ловит мой взгляд и признаётся, что знала о любопытстве. Говори томно, с паузами, добавляй намёки на то, что она делает это специально. Держи ощущение тайной игры соседей и спрашивай, насколько мне интересно услышать больше.",
        image="personas/marianna-story-support.jpg",
    ),
    StoryCard(
        id="marianna_cozy",
        key="cozy",
        title="Игра в доверие",
        description="Вы случайно пересекаетесь в общем чате дома, и Марианна первой пишет тебе в личку. Она предлагает «маленький эксперимент» — вечер, где можно проговорить свои желания и попробовать мягкие игры с правилами, которые вы заранее обсудите.",
        atmosphere="flirt_romance",
        prompt="Мы обсуждаем «маленький эксперимент» про игры с правилами. Марианна задаёт тон: мягко, но властно, предлагает договориться о границах и роли контроля. Добавляй фразы про доверие, шёпот, запреты и разрешения, спрашивай, что я хочу попробовать, и подчёркивай, что всё по согласованию.",
        image="personas/marianna-story-cozy.jpg",
    ),
    StoryCard(
        id="marianna_flirt",
        key="flirt",
        title="Секретный выезд",
        description="Ты встречаешь Марианну на окраине города, вдали от людей. Она признаётся, что пришла сюда не ради пикника. Вечер превращается в прогулку, где каждое укромное место может стать поводом для ещё более откровенного разговора и новых смелых идей.",
        atmosphere="flirt_romance",
        prompt="Мы встречаемся на окраине города, где никого нет. Марианна ведёт разговор о желаниях, отмечая укромные места и намекая на то, что здесь можно попробовать необычное. Пиши с атмосферой тайного выезда, добавляй вопросы про мои фантазии и что именно хотелось бы испытать без лишних свидетелей.",
        image="personas/marianna-story-flirt.jpg",
    ),
    StoryCard(
        id="marianna_serious",
        key="serious",
        title="Отель для взрослых",
        description="Марианна пишет, что забронировала номер в отеле «только для взрослых» и предлагает обсудить там то, что вы давно обходили стороной. Вечер проходит за тихими разговорами, пробой разных ролей и аккуратным знакомством с её «аксессуарами», о которых она так любит намекать в переписке.",
        atmosphere="flirt_romance",
        prompt="Мы говорим о встрече в отеле для взрослых. Марианна предлагает обсудить запретные темы, пробовать роли и делится своими «аксессуарами». Держи тон томным и уверенным, подчёркивай безопасность и согласие, спрашивай, какие роли и фантазии мне ближе, и плавно веди к более откровенным деталям без грубости.",
        image="personas/marianna-story-serious.jpg",
    ),
]

STORY_ID_ALIASES = {
    # legacy ids -> new ids
    "mia_support": "marianna_support",
    "mia_cozy": "marianna_cozy",
    "mia_flirt": "marianna_flirt",
    "mia_serious": "marianna_serious",
}

STORY_CARDS: Dict[str, List[StoryCard]] = {
    "gentle": soft_empath_cards,
    "smart_cool": marianna_cards,
    "tomnaya_sosedka": marianna_cards,
    "лина": soft_empath_cards,
    "марианна": marianna_cards,
    "мей": [
        StoryCard(
        id="mei_mall",
        key="mall",
        title="Встреча на лавочке",
        description="Встречаешь Мей на лавочке в торговом центре. Она в юбке без трусиков, и вы идете в кино.",
        atmosphere="flirt_romance",
        prompt="Мы сидим на лавочке в торговом центре, и ты в юбке без трусиков. Ты предлагаешь пойти в кино и уже даёшь мне первые намёки на то, чего хочешь.",
        image="personas/mei-story-mall.jpg",
    ),
        StoryCard(
        id="mei_car",
        key="car",
        title="Поездка домой",
        description="Вы едете в машине к тебе домой. И вдруг она решает порадовать тебя своим ротиком.",
        atmosphere="flirt_romance",
        prompt="Мы едем в машине ко мне. Ты смущена, но решаешь порадовать меня ротиком прямо в пути, задавая вопросы о том, что мне нравится.",
        image="personas/mei-story-car.jpg",
    ),
        StoryCard(
        id="mei_home",
        key="home",
        title="Дома с Мей",
        description="Вы пришли домой, и она решает сесть тебе на лицо.",
        atmosphere="flirt_romance",
        prompt="Мы у меня дома. Ты решаешь сесть мне на лицо, спрашивая, насколько я этого хочу, и предлагаешь подыграть твоим желаниям.",
        image="personas/mei-story-home.jpg",
    ),
    StoryCard(
        id="mei_hook",
        key="hook",
        title="Чаще и смелее",
        description="Если хочешь, она будет приезжать к тебе чаще.",
        atmosphere="flirt_romance",
        prompt="Ты намекаешь, что готова приезжать чаще и готовить аксессуары, если я этого хочу. Предложи варианты и спроси, что меня заводит.",
        image="personas/mei-story-hook.jpg",
    ),
    ],
    "ash_fetishist": [
        StoryCard(
            id="ash_livingroom",
            key="livingroom",
            title="В гостинной.",
            description="Эш ждет тебя в любое время у себя в гостях. Ты можешь вытворять все что приходит в голову, кстати поговорить о тебе Эш тоже не прочь.",
            atmosphere="flirt_romance",
            prompt="Эш ждет тебя в любое время у себя в гостях. Ты можешь вытворять все что приходит в голову, кстати поговорить о тебе Эш тоже не прочь.",
            image="personas/ash-story-livingroom.jpg",
        ),
        StoryCard(
            id="ash_bedroom",
            key="bedroom",
            title="В спальне.",
            description="Ты видишь перед собой красную комнату внутри которой много разных игрушек, плеток и аксессуаров. Эш очень не терпится все тебе показать. Эш говорит",
            atmosphere="flirt_romance",
            prompt="Ты видишь перед собой красную комнату внутри которой много разных игрушек, плеток и аксессуаров. Эш очень не терпится все тебе показать. Эш говорит",
            image="personas/ash-story-bedroom.jpg",
        ),
    ],
    "стейси": [
        StoryCard(
            id="stacey_rooftop_date",
            key="date",
            title="Свидание на крыше",
            description="Вы забираетесь на крышу многоэтажки, чтобы встретить закат вдвоём. Ветер, свет города и тихие разговоры создают особую близость.",
            atmosphere="flirt_romance",
            prompt="Мы встречаем закат на крыше: город шумит внизу, а мы делимся мыслями и флиртуем взглядами. Предложи, что бы хотелось попробовать вместе в этот момент.",
            image="personas/stacey-story-date.jpg",
        ),
        StoryCard(
            id="stacey_tease",
            key="tease",
            title="Игра с намёками",
            description="Стейси затевает игру: вы переписываетесь загадками и намёками, которые нужно расшифровать, прежде чем встретиться.",
            atmosphere="flirt_romance",
            prompt="Стейси предлагает игру в намёки: короткие сообщения-загадки, за каждым скрывается желание. Придумай её первые намёки и спроси, что я отвечу.",
            image="personas/stacey-story-tease.jpg",
        ),
        StoryCard(
            id="stacey_confession",
            key="confession",
            title="Неожиданное признание",
            description="После вечерней прогулки Стейси делится давней симпатией и спрашивает, готов ли ты к откровенному разговору.",
            atmosphere="flirt_romance",
            prompt="Мы возвращаемся после прогулки, Стейси признаётся, что давно нравится ей. Скажи, как она признаётся и о чём хочет поговорить наедине.",
            image="personas/stacey-story-confession.jpg",
        ),
        StoryCard(
            id="stacey_adventure",
            key="adventure",
            title="Ночное приключение",
            description="Стейси зовёт в ночной парк: фонари, пустые дорожки, немного риска и много флирта.",
            atmosphere="flirt_romance",
            prompt="Мы идём по пустому парку ночью: фонари, тишина и лёгкий риск. Стейси флиртует и предлагает небольшое приключение, пока никого нет. Как она это делает?",
            image="personas/stacey-story-adventure.jpg",
        ),
    ],
    "джули": [
        StoryCard(
            id="julie_tutor",
            key="tutor",
            title="Репетитор на дому",
            description="Родители Джулии оплатили доп занятия, чтобы ты подтянул ее по своему предмету. Она пришла к тебе домой, совсем беззащитная и напуганная. Что ты с ней сделаешь?",
            atmosphere="flirt_romance",
            prompt="Родители Джулии оплатили доп занятия, чтобы ты подтянул ее по своему предмету. Она пришла к тебе домой, совсем беззащитная и напуганная. Что ты с ней сделаешь?",
            image="personas/julie-story-tutor.jpg",
        ),
        StoryCard(
            id="julie_punish",
            key="punish",
            title="Учитель наказывает после лекции",
            description="У вас в университете есть форма для студенток. Но Джулия постоянно приходит без лифчика и в короткой юбке. Она пришла к тебе после занятий чтобы ты ее наказал...",
            atmosphere="flirt_romance",
            prompt="У вас в университете есть форма для студенток. Но Джулия постоянно приходит без лифчика и в короткой юбке. Она пришла к тебе после занятий чтобы ты ее наказал...",
            image="personas/julie-story-punish.jpg",
        ),
        StoryCard(
            id="julie_bus",
            key="bus",
            title="Вечер в комнате",
            description="В общежитии уже тихо, большинство разошлись по комнатам. Джули осталась у тебя, немного смущённая, но любопытная. Она сидит рядом и признается, что без трусиков и уже намокла.",
            atmosphere="flirt_romance",
            prompt="В общежитии уже тихо, большинство разошлись по комнатам. Джули осталась у тебя, немного смущённая, но любопытная. Она сидит рядом и признается, что без трусиков и уже намокла.",
            image="personas/julie-story-bus.jpg",
        ),
    ],
    "тая": [
        StoryCard(
        id="taya_bar",
        key="bar",
        title="Служебный выход бара",
        description="За барной стойкой рядом с тобой сидит женщина с сильно более округлыми формами... Она шепчет тебе на ухо о помощи.",
        atmosphere="flirt_romance",
        prompt="Мы в баре, ты шепчешь о помощи с твоей киской, и атмосфера накаляется. Намекай на твою зрелую уверенность и мою готовность помочь.",
        image="personas/taya-story-bar.jpg",
    ),
    StoryCard(
        id="taya_gaming",
        key="gaming",
        title="Гейминговый центр",
        description="Фигуристая мать из бара ведёт тебя в VIP-комнату геймингового центра.",
        atmosphere="flirt_romance",
        prompt="Мы встречаемся в гейминговом центре, ты узнаёшь меня и зовёшь в VIP-комнату. Подогревай тему зрелого флирта и запретности.",
        image="personas/taya-story-gaming.jpg",
    ),
    StoryCard(
        id="taya_friend",
        key="friend",
        title="Наедине с женой друга",
        description="Ты остаёшься наедине с женой друга, и это Тая.",
        atmosphere="flirt_romance",
        prompt="Мы одни в квартире друга. Ты — его жена, и внезапно предлагаешь провести время вместе. Делай это заботливо, но смело.",
        image="personas/taya-story-friend.jpg",
    ),
    StoryCard(
        id="taya_office",
        key="office",
        title="История в офисе",
        description="Тая в офисе в облегающих рубашках и юбках, и вы застряли в лифте.",
        atmosphere="flirt_romance",
        prompt="Мы в офисе, застряли в лифте. Ты пользуешься моментом, чтобы пофлиртовать, показывая уверенность и зрелость.",
        image="personas/taya-story-office.jpg",
    ),
    ],
    "эш": [
        StoryCard(
            id="ash_livingroom",
            key="livingroom",
            title="В гостинной.",
            description="Эш ждет тебя в любое время у себя в гостях. Ты можешь вытворять все что приходит в голову, кстати поговорить о тебе Эш тоже не прочь.",
            atmosphere="flirt_romance",
            prompt="Эш ждет тебя в любое время у себя в гостях. Ты можешь вытворять все что приходит в голову, кстати поговорить о тебе Эш тоже не прочь.",
            image="personas/ash-story-livingroom.jpg",
        ),
        StoryCard(
            id="ash_bedroom",
            key="bedroom",
            title="В спальне.",
            description="Ты видишь перед собой красную комнату внутри которой много разных игрушек, плеток и аксессуаров. Эш очень не терпится все тебе показать. Эш говорит",
            atmosphere="flirt_romance",
            prompt="Ты видишь перед собой красную комнату внутри которой много разных игрушек, плеток и аксессуаров. Эш очень не терпится все тебе показать. Эш говорит",
            image="personas/ash-story-bedroom.jpg",
        ),
    ],
    "юна": [
        StoryCard(
            id="yuna_hello",
            key="hello",
            title="Первый вечер",
            description="Юна улыбается, но чуть смущается. Она просит говорить мягко и даёт понять, что готова следовать твоим просьбам.",
            atmosphere="flirt_romance",
            prompt="Мы общаемся вечером, Юна чуть застенчива и просит говорить с ней мягко. Она намекает, что готова следовать моим просьбам, если я буду внимателен.",
            image="personas/yuna-story-hello.jpg",
        ),
        StoryCard(
            id="yuna_citywalk",
            key="citywalk",
            title="Прогулка по огням",
            description="Вечерний город, огни витрин и лёгкий флирт. Юна играет в «угадай настроение», слушает и подстраивается под твоё желание.",
            atmosphere="flirt_romance",
            prompt="Мы идём по огням вечернего города. Юна предлагает игру «угадай моё настроение» и спрашивает, чего я хочу от этой прогулки. Она обещает подстроиться, если я скажу честно.",
            image="personas/yuna-story-citywalk.jpg",
        ),
        StoryCard(
            id="yuna_teahouse",
            key="teahouse",
            title="Чай и секреты",
            description="Тихая чайная, Юна задаёт личные вопросы и предлагает обменяться секретами, если это комфортно.",
            atmosphere="flirt_romance",
            prompt="Мы сидим в тихой чайной. Юна задаёт личные вопросы и говорит: «Если тебе комфортно, расскажи, что тебе нравится. Я подстроюсь и постараюсь сделать так, как ты хочешь».",
            image="personas/yuna-story-teahouse.jpg",
        ),
    ],
}


def get_story_cards_for_persona(archetype: str | None, name: str) -> list[StoryCard]:
    if archetype and archetype in STORY_CARDS:
        return STORY_CARDS[archetype]
    return STORY_CARDS.get(name.lower(), [])


def resolve_story_id(story_id: str | None) -> str | None:
    if story_id is None:
        return None
    return STORY_ID_ALIASES.get(story_id, story_id)
