# Grafana Admin Panel - Setup Guide

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞ –Ω–∞ –±–∞–∑–µ Grafana –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Vitte Bot.

## üîç –ü–æ–∏—Å–∫ –ø–æ Telegram ID

**–í—Å–µ –¥–∞—à–±–æ—Ä–¥—ã –∏–º–µ—é—Ç –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø–æ Telegram ID!**

–ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ Telegram ID –≤ –ø–æ–ª–µ –≤–≤–µ—Ä—Ö—É –ª—é–±–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞, –∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ø–æ —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –°—Å—ã–ª–∫—É –Ω–∞ **–ö–∞—Ä—Ç–æ—á–∫—É —é–∑–µ—Ä–∞** —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–ª–∞—Ç–µ–∂–∏, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç.–¥.)

---

## üìä –î–∞—à–±–æ—Ä–¥—ã

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
**URL:** `/d/users-management`

–¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
- Telegram ID (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É —é–∑–µ—Ä–∞)
- **UTM –º–µ—Ç–∫–∞** (–æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- –ò–º—è, –§–∞–º–∏–ª–∏—è, Username
- –Ø–∑—ã–∫
- –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π
- –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –∑–≤–µ–∑–¥ ‚≠ê
- –ù–∞–ª–∏—á–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- –ü–ª–∞–Ω –ø–æ–¥–ø–∏—Å–∫–∏
- –ï—Å—Ç—å –ª–∏ —É–ª—É—á—à–µ–Ω–∏—è

**–ü–æ–∏—Å–∫:**
- –ü–æ Telegram ID (–ø–æ–ª–µ –≤–≤–µ—Ä—Ö—É)
- –ü–æ UTM –º–µ—Ç–∫–µ (—Ñ–∏–ª—å—Ç—Ä)
- –ü–æ –∏–º–µ–Ω–∏/username (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫)

---

### 2. –ü–ª–∞—Ç–µ–∂–∏ –∏ –¥–æ—Ö–æ–¥—ã
**URL:** `/d/payments-revenue`

#### –ë–ª–æ–∫–∏ —Å —Ü–∏—Ñ—Ä–∞–º–∏:
- üí∞ –î–æ—Ö–æ–¥ —Å–µ–≥–æ–¥–Ω—è (stars)
- üí∞ –î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü (stars)
- üí∞ –î–æ—Ö–æ–¥ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è (stars)

#### –¢–∞–±–ª–∏—Ü—ã:
1. **–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∏** - –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ User ID
2. **–¢–æ–ø –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (—Ç–æ–ø 50)

**–ü–æ–∏—Å–∫:** –ü–æ Telegram ID

---

### 3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
**URL:** `/d/technical-metrics`

**–ü–æ–∏—Å–∫:** –ü–æ Telegram ID (–ø–æ–ª–µ –≤–≤–µ—Ä—Ö—É) ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É —é–∑–µ—Ä–∞

#### –°—á–µ—Ç—á–∏–∫–∏:
- –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ 24—á
- –í—Å–µ–≥–æ –¥–∏–∞–ª–æ–≥–æ–≤
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- –°—Ä–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–π/—é–∑–µ—Ä
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫

#### –ì—Ä–∞—Ñ–∏–∫–∏:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)
- –°–æ–æ–±—â–µ–Ω–∏—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)

---

### 4. –ö–∞—Ä—Ç–æ—á–∫–∞ —é–∑–µ—Ä–∞
**URL:** `/d/user-card?var-telegram_id=<ID>`

–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:

#### –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
- Telegram ID
- Username
- –ò–º—è, –§–∞–º–∏–ª–∏—è
- –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

#### –ü–ª–∞—Ç–µ–∂–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∞:
- –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –∑–≤–µ–∑–¥
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π
- –ù–∞–ª–∏—á–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- –ü–ª–∞–Ω –ø–æ–¥–ø–∏—Å–∫–∏

#### –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
- –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤

#### –£–ª—É—á—à–µ–Ω–∏—è:
- –°–ø–∏—Å–æ–∫ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏—á
- –ö—É–ø–ª–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –û—Å—Ç–∞—Ç–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–î–æ—Å—Ç—É–ø:** –ß–µ—Ä–µ–∑ –ø–æ–ª–µ "Telegram ID" –≤–≤–µ—Ä—Ö—É –∏–ª–∏ –∫–ª–∏–∫ –ø–æ ID –≤ –¥—Ä—É–≥–∏—Ö –¥–∞—à–±–æ—Ä–¥–∞—Ö

---

### 5. –°–µ—Ä–≤–∏—Å —Ä–∞—Å—Å—ã–ª–∫–∏
**URL:** `/d/broadcast-service`

**–ü–æ–∏—Å–∫:** –ü–æ Telegram ID (–ø–æ–ª–µ –≤–≤–µ—Ä—Ö—É) ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É —é–∑–µ—Ä–∞

–°—Ç–∞—Ç—É—Å: –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–ø–æ–∫–∞ –ø—É—Å—Ç–æ–π –¥–∞—à–±–æ—Ä–¥)

---

## üéØ UTM Tracking

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç UTM –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ —Å UTM –º–µ—Ç–∫–æ–π, –æ–Ω–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

#### –§–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏:
```
https://t.me/vitteaidevbot?start=<utm_source>
```

#### –ü—Ä–∏–º–µ—Ä—ã:
```bash
# –†–µ–∫–ª–∞–º–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è Facebook
https://t.me/vitteaidevbot?start=fb_ads_winter2026

# –ò–Ω—Ñ–ª—é–µ–Ω—Å–µ—Ä
https://t.me/vitteaidevbot?start=influencer_ivanov

# YouTube —Ä–µ–∫–ª–∞–º–∞
https://t.me/vitteaidevbot?start=youtube_promo_jan

# Email —Ä–∞—Å—Å—ã–ª–∫–∞
https://t.me/vitteaidevbot?start=email_newsletter_01

# –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
https://t.me/vitteaidevbot?start=partner_tech_blog
```

#### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –ø–æ —Å—Å—ã–ª–∫–µ ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–æ—Ç
2. Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `/start <utm_source>`
3. –ë–æ—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç UTM –º–µ—Ç–∫—É –∏–∑ –∫–æ–º–∞–Ω–¥—ã
4. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è UTM **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ `utm_source`**
5. UTM **–Ω–∞–≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞** –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è)

#### –ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å UTM:
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** - –∫–æ–ª–æ–Ω–∫–∞ "UTM –º–µ—Ç–∫–∞"
- **–ö–∞—Ä—Ç–æ—á–∫–∞ —é–∑–µ—Ä–∞** - –±–ª–æ–∫ "–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
- **API endpoint** - `/analytics/users/all?utm_source=fb_ads_winter2026`

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ UTM –æ—Ç–±–∏–≤–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö
docker logs vitte_bot | grep "UTM"

# –ü—Ä–∏–º–µ—Ä:
# INFO - UTM source detected: fb_ads_winter2026 for user 123456789
# INFO - New user registered: 123456789 (@username) with 10 free images | UTM: fb_ads_winter2026
```

---

## üöÄ –ó–∞–ø—É—Å–∫

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é UTM

```bash
cd telegram-bot-microservices

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
docker exec -it vitte_postgres psql -U vitte_user -d vitte_bot -c "
ALTER TABLE users ADD COLUMN IF NOT EXISTS utm_source VARCHAR(255);
CREATE INDEX IF NOT EXISTS ix_users_utm_source ON users(utm_source);
"
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Grafana –∏ Admin
docker compose stop grafana admin

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Admin (–Ω–æ–≤—ã–µ API endpoints)
docker compose up -d --build admin

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Grafana —Å provisioning
docker compose up -d grafana

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker compose ps grafana admin
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É Infinity plugin

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Grafana
docker logs vitte_grafana | grep -i infinity

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# "Successfully installed plugin: yesoreyeram-infinity-datasource"
```

### –®–∞–≥ 4: –î–æ—Å—Ç—É–ø –∫ Grafana

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø (—á–µ—Ä–µ–∑ SSH tunnel)

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
ssh -L 3000:localhost:3000 ubuntu@vittecpu

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
http://localhost:3000

# –õ–æ–≥–∏–Ω: admin
# –ü–∞—Ä–æ–ª—å: –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π $GRAFANA_PASSWORD
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Nginx (production)

–î–æ–±–∞–≤–∏—Ç—å –≤ `nginx.conf`:

```nginx
# Grafana Admin Panel (internal)
server {
    listen 80;
    server_name grafana.vitte.local;

    location / {
        proxy_pass http://grafana:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # WebSocket support –¥–ª—è live updates
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx:
```bash
docker compose restart nginx
```

–î–æ–±–∞–≤–∏—Ç—å DNS –∑–∞–ø–∏—Å—å –∏–ª–∏ –≤ `/etc/hosts`:
```
<SERVER_IP> grafana.vitte.local
```

---

## üì° API Endpoints

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ Admin service (–ø–æ—Ä—Ç 8080):

### Users Management
- `GET /analytics/users/all?skip=0&limit=100&telegram_id=<id>&utm_source=<utm>&search=<query>`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

### Revenue
- `GET /analytics/revenue/summary`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ—Ö–æ–¥ (—Å–µ–≥–æ–¥–Ω—è, –º–µ—Å—è—Ü, –≤—Å–µ –≤—Ä–µ–º—è)

### Payments
- `GET /analytics/payments/recent?skip=0&limit=100&telegram_id=<id>`
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∏

- `GET /analytics/payments/top-spenders?limit=50`
- –¢–æ–ø –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### User Card
- `GET /analytics/user/<telegram_id>/card`
- –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Technical Stats
- `GET /analytics/tech/stats`
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã

### Broadcast (placeholder)
- `GET /analytics/broadcast/stats`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å—Å—ã–ª–æ–∫ (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Datasources

**PostgreSQL** (default):
- Host: `postgres:5432`
- Database: `${POSTGRES_DB}`
- User: `${POSTGRES_USER}`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

**Admin API** (Infinity plugin):
- URL: `http://admin:8080`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–∞–±–ª–∏—Ü –∏ —Å—á–µ—Ç—á–∏–∫–æ–≤

**Prometheus**:
- URL: `http://prometheus:9090`
- –î–ª—è –±—É–¥—É—â–∏—Ö –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üõ†Ô∏è Troubleshooting

### Grafana –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs vitte_grafana --tail 100

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å provisioning —Ñ–∞–π–ª—ã
docker exec vitte_grafana ls -la /etc/grafana/provisioning/datasources
docker exec vitte_grafana ls -la /etc/grafana/dashboards
```

### Infinity plugin –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è

```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é
docker exec -it vitte_grafana grafana-cli plugins install yesoreyeram-infinity-datasource

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose restart grafana
```

### Datasource –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Admin API
docker exec vitte_grafana curl -v http://admin:8080/analytics/tech/stats

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PostgreSQL
docker exec vitte_grafana pg_isready -h postgres -p 5432 -U vitte_user
```

### –î–∞—à–±–æ—Ä–¥—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª—ã —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
docker exec vitte_grafana ls -la /etc/grafana/dashboards/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
cat infrastructure/monitoring/grafana/dashboards/users_management.json | jq .
```

### API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Admin service
docker logs vitte_admin --tail 100

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
docker exec -it vitte_postgres psql -U vitte_user -d vitte_bot -c "\\d users"
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–ª–æ–Ω–∫–∞ utm_source
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ

### –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:
```
telegram-bot-microservices/
‚îú‚îÄ‚îÄ alembic/versions/
‚îÇ   ‚îî‚îÄ‚îÄ 20260126_add_utm_source.py                    # –ú–∏–≥—Ä–∞—Ü–∏—è UTM
‚îú‚îÄ‚îÄ services/bot/admin/app/routes/
‚îÇ   ‚îî‚îÄ‚îÄ analytics.py                                   # API endpoints –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ (600+ —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ infrastructure/monitoring/grafana/
‚îÇ   ‚îú‚îÄ‚îÄ provisioning/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ datasources/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ datasources.yml                       # PostgreSQL + Admin API + Prometheus
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dashboards/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dashboards.yml                         # Provisioning config
‚îÇ   ‚îî‚îÄ‚îÄ dashboards/
‚îÇ       ‚îú‚îÄ‚îÄ users_management.json                      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ       ‚îú‚îÄ‚îÄ payments_revenue.json                      # –ü–ª–∞—Ç–µ–∂–∏ –∏ –¥–æ—Ö–æ–¥—ã
‚îÇ       ‚îú‚îÄ‚îÄ technical_metrics.json                     # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (—Å –ø–æ–∏—Å–∫–æ–º)
‚îÇ       ‚îú‚îÄ‚îÄ user_card.json                             # –ö–∞—Ä—Ç–æ—á–∫–∞ —é–∑–µ—Ä–∞
‚îÇ       ‚îî‚îÄ‚îÄ broadcast_service.json                     # –°–µ—Ä–≤–∏—Å —Ä–∞—Å—Å—ã–ª–∫–∏ (—Å –ø–æ–∏—Å–∫–æ–º)
‚îî‚îÄ‚îÄ GRAFANA_ADMIN_SETUP.md                            # –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `shared/database/models.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `utm_source` –≤ User
- `shared/database/services.py` - –ø–∞—Ä–∞–º–µ—Ç—Ä `utm_source` –≤ create_user()
- `services/bot/app/handlers/start.py` - **–∑–∞—Ö–≤–∞—Ç UTM –º–µ—Ç–∫–∏ –∏–∑ /start –∫–æ–º–∞–Ω–¥—ã**
- `services/bot/admin/app/main.py` - –¥–æ–±–∞–≤–ª–µ–Ω analytics_router
- `docker-compose.yml` - –æ–±–Ω–æ–≤–ª–µ–Ω Grafana —Å provisioning + Infinity plugin

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–æ–±–∞–≤–∏—Ç—å Nginx —Ä–æ—É—Ç –¥–ª—è Grafana** (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏—è** (Alerts –≤ Grafana)
3. **–î–æ–±–∞–≤–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ Redis –º–µ—Ç—Ä–∏–∫** (memory, hit rate, keys)
4. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å —Ä–∞—Å—Å—ã–ª–∫–∏** –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞—à–±–æ—Ä–¥
5. **–î–æ–±–∞–≤–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ LLM –º–µ—Ç—Ä–∏–∫** (—Ç–æ–∫–µ–Ω—ã, latency, errors)

---

## üì∏ Screenshots

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–∞—à–±–æ—Ä–¥—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- http://localhost:3000/dashboards (—Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤)
- http://localhost:3000/d/users-management (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
- http://localhost:3000/d/payments-revenue (–ø–ª–∞—Ç–µ–∂–∏)
- http://localhost:3000/d/technical-metrics (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏)
- http://localhost:3000/d/user-card (–∫–∞—Ä—Ç–æ—á–∫–∞ —é–∑–µ—Ä–∞)
- http://localhost:3000/d/broadcast-service (—Ä–∞—Å—Å—ã–ª–∫–∏)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-26
**–í–µ—Ä—Å–∏—è:** 1.0.0
**–ê–≤—Ç–æ—Ä:** Claude + Adam
