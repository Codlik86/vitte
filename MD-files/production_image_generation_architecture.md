# Production –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã –æ ComfyUI](#–∫–ª—é—á–µ–≤—ã–µ-—Ñ–∞–∫—Ç—ã-–æ-comfyui)
- [–í–∞—Ä–∏–∞–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä](#–≤–∞—Ä–∏–∞–Ω—Ç—ã-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä)
- [–°–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π](#—Å–∏—Å—Ç–µ–º—ã-–æ—á–µ—Ä–µ–¥–µ–π)
- [–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–¥–∞)
- [FAQ](#faq)

---

## –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã –æ ComfyUI

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

ComfyUI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** ‚Äî —ç—Ç–æ by design. –û–¥–Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—è = –æ–¥–Ω–∞ –æ—á–µ—Ä–µ–¥—å.

> –ï—Å–ª–∏ 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏—Ö–æ–¥—è—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, 30-–π –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –∂–¥–∞—Ç—å ~30 —Å–µ–∫—É–Ω–¥ (–ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 1 —Å–µ–∫/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)

### –ü—Ä–æ–±–ª–µ–º–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—è–º–∏ –Ω–∞ –æ–¥–Ω–æ–π GPU

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö ComfyUI —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–∞ –æ–¥–Ω–æ–π GPU:
- –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª–∏ **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ**
- –ú–æ–¥–µ–ª–∏ **–¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ VRAM**
- –ù–∞ GPU —Å 48GB –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å 2-3 –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏, –Ω–æ VRAM —Ä–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

---

## –í–∞—Ä–∏–∞–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–¥–Ω–∞ GPU + –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (–±–∞–∑–æ–≤—ã–π)

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:** –Ω–µ–±–æ–ª—å—à–æ–≥–æ —á–∏—Å–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 2-4 —Å–µ–∫

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Redis     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Worker    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  ComfyUI    ‚îÇ
‚îÇ     Bot     ‚îÇ     ‚îÇ   Queue     ‚îÇ     ‚îÇ  (Celery)   ‚îÇ     ‚îÇ    API      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ù–∞–¥–µ–∂–Ω–∞—è –æ—á–µ—Ä–µ–¥—å
- –õ–µ–≥–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ù–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
- –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Ä–∞—Å—Ç–µ—Ç –ª–∏–Ω–µ–π–Ω–æ —Å –æ—á–µ—Ä–µ–¥—å—é

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–µ—Å–∫–æ–ª—å–∫–æ ComfyUI –∏–Ω—Å—Ç–∞–Ω—Ü–∏–π + Load Balancer

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:** GPU —Å –±–æ–ª—å—à–∏–º VRAM (24GB+), –ª–µ–≥–∫–∏–µ –º–æ–¥–µ–ª–∏

```
                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                         ‚îå‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  ComfyUI-1  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ    ‚îÇ  :8188      ‚îÇ
‚îÇ   Worker    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ   Pool      ‚îÇ          ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  ComfyUI-2  ‚îÇ
                              ‚îÇ  :8189      ‚îÇ
                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–†–∞—Å—á–µ—Ç VRAM:**
| –ú–æ–¥–µ–ª—å | VRAM –Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—é | –ú–∞–∫—Å. –∏–Ω—Å—Ç–∞–Ω—Ü–∏–π (24GB) |
|--------|-------------------|------------------------|
| SD 1.5 | ~4GB | 4-5 |
| SDXL | ~8-10GB | 2 |
| Flux | ~12-16GB | 1 |

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –†–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ throughput –≤ N —Ä–∞–∑

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –≤ VRAM
- –°–ª–æ–∂–Ω–µ–µ —É–ø—Ä–∞–≤–ª—è—Ç—å

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: Serverless GPU (RunPod/Modal)

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:** –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, production SaaS

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     Bot     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   RunPod    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Auto-scaling Workers       ‚îÇ
‚îÇ             ‚îÇ     ‚îÇ   API       ‚îÇ     ‚îÇ  (0 ‚Üí N GPU instances)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ RunPod Serverless:**
- –ê–≤—Ç–æ—Å–∫–µ–π–ª–∏–Ω–≥ –æ—Ç 0 –¥–æ —Å–æ—Ç–µ–Ω –≤–æ—Ä–∫–µ—Ä–æ–≤
- Pay-per-use (–ø–æ—Å–µ–∫—É–Ω–¥–Ω–∞—è –æ–ø–ª–∞—Ç–∞)
- 48% cold starts –ø–æ–¥ 200ms
- Cold start –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: 6-12 —Å–µ–∫—É–Ω–¥

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –∫–æ–≥–¥–∞ idle
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫–µ–π–ª–∏–Ω–≥
- –ù–µ –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- Cold start latency
- –î–æ—Ä–æ–∂–µ –ø—Ä–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

---

### –í–∞—Ä–∏–∞–Ω—Ç 4: Distributed ComfyUI (Multi-GPU)

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:** –Ω–µ—Å–∫–æ–ª—å–∫–æ GPU, –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ **ComfyUI-Distributed**:
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö GPU
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π load balancing
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Master    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ          Worker Pool                ‚îÇ
‚îÇ  ComfyUI    ‚îÇ     ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ  ‚îÇGPU-0‚îÇ  ‚îÇGPU-1‚îÇ  ‚îÇGPU-N‚îÇ         ‚îÇ
                    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –°–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –°–∏—Å—Ç–µ–º–∞ | –Ø–∑—ã–∫ | –õ—É—á—à–µ –¥–ª—è | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|---------|------|-----------|-------------|
| **Celery + Redis** | Python | ML jobs, image processing | –°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è Python |
| **BullMQ** | Node.js/Python | High concurrency | Concurrency 100+, retries |
| **RabbitMQ** | Any | Microservices, ordering | Feature-complete, –Ω–∞–¥–µ–∂–Ω—ã–π |
| **Redis Streams** | Any | Real-time, fast queues | In-memory, –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π |

### Celery (Python)

```python
from celery import Celery

app = Celery('tasks', broker='redis://localhost')

@app.task
def generate_image(prompt):
    # –í—ã–∑–æ–≤ ComfyUI API
    return result
```

**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:** Image processing, ML model calls, PDF generation

### BullMQ (Node.js)

```javascript
import { Queue, Worker } from 'bullmq';

const queue = new Queue('ImageGeneration');

const worker = new Worker('ImageGeneration', async job => {
    return await generateImage(job.data);
}, { concurrency: 100 });
```

**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:** High-performance queues, retries, rate limiting

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –î–ª—è —á–∞—Ç—Ç–∏–Ω–≥-–±–æ—Ç–∞ —Å –æ–¥–Ω–æ–π –∞—Ä–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–π GPU

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ    Redis    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Worker    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  ComfyUI    ‚îÇ
‚îÇ     Bot     ‚îÇ     ‚îÇ   (Queue)   ‚îÇ     ‚îÇ  (Python)   ‚îÇ     ‚îÇ    API      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ                   ‚îÇ
                           ‚ñº                   ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Job Status ‚îÇ     ‚îÇ  Callback   ‚îÇ
                    ‚îÇ   Storage   ‚îÇ     ‚îÇ  to Bot     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Docker Compose

```yaml
version: '3.8'

services:
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    restart: always
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  comfyui:
    image: your-comfyui-image
    command: python main.py --listen 0.0.0.0 --port 8188
    volumes:
      - ./models:/app/models
      - ./output:/app/output
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8188/system_stats"]
      interval: 30s
      timeout: 10s
      retries: 3

  worker:
    build: ./worker
    environment:
      - REDIS_URL=redis://redis:6379
      - COMFYUI_URL=http://comfyui:8188
      - BOT_CALLBACK_URL=http://bot:8080/callback
    depends_on:
      redis:
        condition: service_healthy
      comfyui:
        condition: service_healthy
    restart: always

  bot:
    build: ./bot
    environment:
      - TELEGRAM_TOKEN=${TELEGRAM_TOKEN}
      - REDIS_URL=redis://redis:6379
    depends_on:
      redis:
        condition: service_healthy
    ports:
      - "8080:8080"
    restart: always

volumes:
  redis_data:
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### Worker —Å Celery

```python
# worker/tasks.py
import time
import requests
from celery import Celery

app = Celery('tasks', broker='redis://redis:6379')

COMFYUI_URL = 'http://comfyui:8188'

@app.task(bind=True, max_retries=3, default_retry_delay=5)
def generate_image(self, workflow: dict, user_id: str, callback_url: str = None):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç workflow –≤ ComfyUI –∏ –∂–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    """
    try:
        # –û—Ç–ø—Ä–∞–≤–∫–∞ prompt –≤ ComfyUI
        response = requests.post(
            f'{COMFYUI_URL}/prompt',
            json={'prompt': workflow},
            timeout=10
        )
        response.raise_for_status()
        prompt_id = response.json()['prompt_id']
        
        # Polling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        result = poll_for_result(prompt_id, timeout=120)
        
        # Callback –∫ –±–æ—Ç—É
        if callback_url:
            requests.post(callback_url, json={
                'user_id': user_id,
                'prompt_id': prompt_id,
                'status': 'completed',
                'images': result['images']
            })
        
        return result
        
    except Exception as exc:
        self.retry(exc=exc)


def poll_for_result(prompt_id: str, timeout: int = 120) -> dict:
    """
    –û–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    """
    start_time = time.time()
    
    while time.time() - start_time < timeout:
        response = requests.get(f'{COMFYUI_URL}/history/{prompt_id}')
        history = response.json()
        
        if prompt_id in history:
            status = history[prompt_id].get('status', {})
            if status.get('completed'):
                return extract_images(history[prompt_id])
            if status.get('status_str') == 'error':
                raise Exception(f"Generation failed: {status}")
        
        time.sleep(0.5)
    
    raise TimeoutError(f"Generation timeout after {timeout}s")


def extract_images(history_item: dict) -> dict:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    """
    images = []
    outputs = history_item.get('outputs', {})
    
    for node_id, node_output in outputs.items():
        if 'images' in node_output:
            for img in node_output['images']:
                images.append({
                    'filename': img['filename'],
                    'subfolder': img.get('subfolder', ''),
                    'type': img.get('type', 'output'),
                    'url': f"{COMFYUI_URL}/view?filename={img['filename']}&type={img.get('type', 'output')}"
                })
    
    return {'images': images}
```

### Bot –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```python
# bot/main.py
from aiogram import Bot, Dispatcher, types
from aiogram.types import InputFile
import aiohttp
import redis.asyncio as redis
from celery import Celery

bot = Bot(token=TELEGRAM_TOKEN)
dp = Dispatcher()
redis_client = redis.from_url('redis://redis:6379')
celery_app = Celery('tasks', broker='redis://redis:6379')

@dp.message_handler(commands=['generate'])
async def generate_handler(message: types.Message):
    user_id = str(message.from_user.id)
    prompt_text = message.get_args()
    
    if not prompt_text:
        await message.reply("–£–∫–∞–∂–∏—Ç–µ –ø—Ä–æ–º–ø—Ç: /generate –≤–∞—à –ø—Ä–æ–º–ø—Ç")
        return
    
    # –°–æ–∑–¥–∞–µ–º workflow
    workflow = create_workflow(prompt_text)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
    task = celery_app.send_task(
        'tasks.generate_image',
        args=[workflow, user_id, f'http://bot:8080/callback']
    )
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º task_id –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
    await redis_client.set(f'task:{user_id}', task.id, ex=3600)
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –æ—á–µ—Ä–µ–¥–∏
    queue_length = await get_queue_length()
    
    await message.reply(
        f"‚è≥ –ó–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç!\n"
        f"üìç –ü–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏: {queue_length}\n"
        f"‚è± –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è: ~{queue_length * 3} —Å–µ–∫"
    )


@dp.callback_query_handler(lambda c: c.data == 'check_status')
async def check_status(callback_query: types.CallbackQuery):
    user_id = str(callback_query.from_user.id)
    task_id = await redis_client.get(f'task:{user_id}')
    
    if not task_id:
        await callback_query.answer("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á")
        return
    
    result = celery_app.AsyncResult(task_id.decode())
    
    if result.ready():
        await callback_query.answer("‚úÖ –ì–æ—Ç–æ–≤–æ!")
    else:
        await callback_query.answer("‚è≥ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ...")


# Callback endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
from aiohttp import web

async def callback_handler(request):
    data = await request.json()
    user_id = data['user_id']
    images = data.get('images', [])
    
    if images:
        for img in images:
            # –°–∫–∞—á–∏–≤–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            async with aiohttp.ClientSession() as session:
                async with session.get(img['url']) as resp:
                    image_data = await resp.read()
                    
            await bot.send_photo(
                chat_id=user_id,
                photo=InputFile(io.BytesIO(image_data), filename=img['filename']),
                caption="üé® –í–∞—à–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!"
            )
    
    return web.Response(text='OK')
```

### Load Balancer –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö ComfyUI

```python
# worker/comfyui_pool.py
import asyncio
import aiohttp
from dataclasses import dataclass
from typing import List, Optional

@dataclass
class ComfyUIInstance:
    url: str
    busy: bool = False
    current_job: Optional[str] = None

class ComfyUIPool:
    def __init__(self, urls: List[str]):
        self.instances = [ComfyUIInstance(url=url) for url in urls]
        self.lock = asyncio.Lock()
    
    async def get_available(self) -> Optional[ComfyUIInstance]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –∏–ª–∏ –∂–¥–µ—Ç"""
        async with self.lock:
            for instance in self.instances:
                if not instance.busy:
                    instance.busy = True
                    return instance
        
        # –í—Å–µ –∑–∞–Ω—è—Ç—ã - –∂–¥–µ–º
        while True:
            await asyncio.sleep(0.1)
            async with self.lock:
                for instance in self.instances:
                    if not instance.busy:
                        instance.busy = True
                        return instance
    
    async def release(self, instance: ComfyUIInstance):
        """–û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –∏–Ω—Å—Ç–∞–Ω—Å"""
        async with self.lock:
            instance.busy = False
            instance.current_job = None
    
    async def health_check(self) -> dict:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –≤—Å–µ—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤"""
        results = {}
        async with aiohttp.ClientSession() as session:
            for instance in self.instances:
                try:
                    async with session.get(
                        f"{instance.url}/system_stats",
                        timeout=aiohttp.ClientTimeout(total=5)
                    ) as resp:
                        results[instance.url] = {
                            'status': 'healthy' if resp.status == 200 else 'unhealthy',
                            'busy': instance.busy
                        }
                except:
                    results[instance.url] = {'status': 'unreachable', 'busy': instance.busy}
        return results


# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
pool = ComfyUIPool([
    'http://comfyui-1:8188',
    'http://comfyui-2:8189',
])

async def generate_with_pool(workflow: dict):
    instance = await pool.get_available()
    try:
        async with aiohttp.ClientSession() as session:
            async with session.post(
                f"{instance.url}/prompt",
                json={'prompt': workflow}
            ) as resp:
                return await resp.json()
    finally:
        await pool.release(instance)
```

---

## FAQ

### –ú–æ–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –Ω–∞ –æ–¥–Ω–æ–π GPU?

**–î–∞, –Ω–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏:**
- –ö–∞–∂–¥—ã–π ComfyUI –∏–Ω—Å—Ç–∞–Ω—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ, –¥—É–±–ª–∏—Ä—É—è VRAM
- –ù–∞ 24GB GPU –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å 2 –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏ —Å –ª–µ–≥–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ (SD 1.5)
- –î–ª—è SDXL/Flux ‚Äî –æ–¥–Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—è –º–∞–∫—Å–∏–º—É–º

### –ö–∞–∫—É—é —Å–∏—Å—Ç–µ–º—É –æ—á–µ—Ä–µ–¥–µ–π –≤—ã–±—Ä–∞—Ç—å?

| –í–∞—à —Å—Ç–µ–∫ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|--------------|
| Python –±–æ—Ç | Celery + Redis |
| Node.js –±–æ—Ç | BullMQ |
| –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ | RabbitMQ |
| –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–µ–∫—Ç | Redis Streams |

### –ö–æ–≥–¥–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ Serverless?

- –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (–ø–∏–∫–∏/–ø—Ä–æ—Å—Ç–æ–∏)
- –ù—É–∂–µ–Ω –∞–≤—Ç–æ—Å–∫–µ–π–ª–∏–Ω–≥
- –ù–µ —Ö–æ—Ç–∏—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å GPU –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- –ë—é–¥–∂–µ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç pay-per-use –º–æ–¥–µ–ª—å

### –ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏?

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π** ‚Äî –¥–µ—Ä–∂–∞—Ç—å –º–æ–¥–µ–ª–∏ –≤ VRAM
2. **–ë–∞—Ç—á–∏–Ω–≥** ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ö–æ–∂–∏–µ –∑–∞–ø—Ä–æ—Å—ã
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è workflow** ‚Äî —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ –Ω–æ–¥—ã
4. **–ë—ã—Å—Ç—Ä—ã–µ –º–æ–¥–µ–ª–∏** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Turbo/Lightning –≤–µ—Ä—Å–∏–∏

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [ComfyUI API Documentation](https://github.com/comfyanonymous/ComfyUI)
- [ComfyUI-Distributed](https://github.com/robertvoy/ComfyUI-Distributed)
- [RunPod Serverless Docs](https://docs.runpod.io/serverless/overview)
- [Celery Documentation](https://docs.celeryq.dev/)
- [BullMQ Documentation](https://bullmq.io/)

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: –§–µ–≤—Ä–∞–ª—å 2026*
