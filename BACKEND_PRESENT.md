# Backend Presentation: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–≤–æ–π –Ω–µ–¥–µ–ª–∏

> –ü–æ–ª–Ω—ã–π –±—ç–∫–µ–Ω–¥ + –¥–µ–ø–ª–æ–π –Ω–∞ production —Å–µ—Ä–≤–µ—Ä

---

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**10 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç:**

| –°–µ—Ä–≤–∏—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|--------|------------|--------|
| Bot | Telegram –±–æ—Ç (aiogram 3.15) | ‚úÖ Healthy |
| API | REST API (FastAPI) | ‚úÖ Healthy |
| Admin | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | ‚úÖ Healthy |
| Worker | –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (Celery) | ‚úÖ Healthy |
| Beat | Scheduler –¥–ª—è –∑–∞–¥–∞—á | ‚úÖ Healthy |
| PostgreSQL | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | ‚úÖ Healthy |
| Redis | –ö–µ—à + –±—Ä–æ–∫–µ—Ä | ‚úÖ Healthy |
| Nginx | Reverse proxy | ‚úÖ Healthy |
| Prometheus | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ | ‚úÖ Running |
| Grafana | –î–∞—à–±–æ—Ä–¥—ã | ‚úÖ Running |

---

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**5 —Ç–∞–±–ª–∏—Ü —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ (Alembic):**
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram
- `subscriptions` - –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –ª–∏–º–∏—Ç—ã
- `dialogs` - –¥–∏–∞–ª–æ–≥–∏ —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
- `messages` - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- `settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**Connection Pool:** 50 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (20 + 30 overflow)

---

### 3. Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

- **User cache:** TTL 5 –º–∏–Ω—É—Ç
- **Subscription cache:** TTL 1 —á–∞—Å
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 80% —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î

---

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ Rate limiting (10 msg/min, –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
- ‚úÖ –í—Å–µ –ø–æ—Ä—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã (—Ç–æ–ª—å–∫–æ Nginx –Ω–∞—Ä—É–∂—É)
- ‚úÖ Non-root –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- ‚úÖ –°–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (PostgreSQL, Redis, Grafana)
- ‚úÖ Internal network –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

---

### 5. –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (Celery)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏:**
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)
- –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏

**4 –≤–æ—Ä–∫–µ—Ä–∞** –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

### 6. API Endpoints

```
GET/PATCH /api/v1/subscriptions/{user_id}
GET/POST  /api/v1/dialogs/
GET/PATCH /api/v1/dialogs/{id}
GET       /api/v1/dialogs/{id}/messages
GET       /api/v1/health, /health/db, /health/redis
```

---

### 7. –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (i18n)

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏–∑ Telegram
- ‚úÖ –†—É—Å—Å–∫–∏–π –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥—ã
- ‚úÖ Fluent —Ñ–æ—Ä–º–∞—Ç (.ftl —Ñ–∞–π–ª—ã)
- ‚è≥ UI –¥–ª—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞ (–±—É–¥–µ—Ç –ø–æ–∑–∂–µ)

---

## Production —Å–µ—Ä–≤–µ—Ä

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| IP | 195.209.210.96 |
| CPU | 4 vCPU |
| RAM | 8 GB |
| –î–∏—Å–∫ | 60 GB SSD |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ | 3,000-5,000-10,000 + –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

**–°—Ç–∞—Ç—É—Å: üü¢ LIVE**

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ ( –£–î–ê–õ–ò–ú –ß–¢–û –ï–°–¢–¨ –°–ï–ô–ß–ê–°, –¢–ï–°–¢–ò–†–û–í–ê–õ )

| –ö–æ–º–∞–Ω–¥–∞ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
|---------|------------|
| /start | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ |
| /help | –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ |
| /status | –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –ª–∏–º–∏—Ç—ã |

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ

1. **AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - LLM —Å–µ—Ä–≤–∏—Å, –ø–µ—Ä—Å–æ–Ω–∞–∂–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. **Web App** - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
3. **–ü–ª–∞—Ç–µ–∂–∏** - Telegram Stars
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - Sentry, custom –º–µ—Ç—Ä–∏–∫–∏

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.11** + aiogram 3.15 + FastAPI
- **PostgreSQL 15** + Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
- **Redis 7** + Celery 5.3
- **Docker Compose** + Nginx
- **Prometheus + Grafana**

---

## üñ•Ô∏è –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã - –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# vitte_bot        Up (healthy)
# vitte_api        Up (healthy)
# vitte_worker     Up (healthy)
# vitte_postgres   Up (healthy)
# ... –≤—Å–µ 10 —Å–µ—Ä–≤–∏—Å–æ–≤
```

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats --no-stream --format "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}"
```

---

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - —Ç–∞–±–ª–∏—Ü—ã –∏ –¥–∞–Ω–Ω—ã–µ

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
docker exec -it vitte_postgres psql -U vitte_user -d vitte_bot

# –í–Ω—É—Ç—Ä–∏ psql:
\dt                              -- —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
SELECT COUNT(*) FROM users;      -- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT * FROM users LIMIT 5;     -- –ø–µ—Ä–≤—ã–µ 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT * FROM subscriptions;     -- –ø–æ–¥–ø–∏—Å–∫–∏
\q                               -- –≤—ã—Ö–æ–¥
```

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
docker compose run --rm migrations alembic history
```

---

### 3. Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
docker exec -it vitte_redis redis-cli -a '–í–ê–®_–ü–ê–†–û–õ–¨'

# –í–Ω—É—Ç—Ä–∏ redis-cli:
KEYS *                           -- –≤—Å–µ –∫–ª—é—á–∏ –≤ –∫–µ—à–µ
GET user:5575533898              -- –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–µ—à–∞
TTL user:5575533898              -- –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–ª—é—á–∞ (—Å–µ–∫—É–Ω–¥—ã)
INFO stats                       -- —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (hits/misses)
```

---

### 4. Rate Limiting - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞

```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞ - –≤–∏–¥–Ω–æ throttling
docker logs vitte_bot --tail 20 | grep -i "throttl\|rate\|limit"

# Redis –∫–ª—é—á–∏ rate limiter
docker exec -it vitte_redis redis-cli -a '–í–ê–®_–ü–ê–†–û–õ–¨' KEYS "*rate*"
```

```bash
# –¢–µ—Å—Ç: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å 15 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥—Ä—è–¥ –≤ –±–æ—Ç–∞
# –ü–æ—Å–ª–µ 10-–≥–æ –±–æ—Ç –Ω–∞—á–Ω–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤"
```

---

### 5. Celery - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

```bash
# –õ–æ–≥–∏ worker - –≤–∏–¥–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á
docker logs vitte_worker --tail 30

# –õ–æ–≥–∏ beat - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á
docker logs vitte_beat --tail 20
```

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á –≤ Redis
docker exec -it vitte_redis redis-cli -a '–í–ê–®_–ü–ê–†–û–õ–¨' LLEN celery
```

---

### 6. API Endpoints

```bash
# Health check
curl http://localhost/api/v1/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
curl http://localhost/api/v1/health/db

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
curl http://localhost/api/v1/health/redis

# –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl http://localhost/api/v1/subscriptions/5575533898
```

---

### 7. i18n - –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞ - –≤–∏–¥–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞
docker logs vitte_bot --tail 50 | grep -i "locale\|language"

# –§–∞–π–ª—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤
docker exec vitte_bot ls -la /app/app/locales/
docker exec vitte_bot cat /app/app/locales/ru/ru.ftl | head -20
```

---

### 8. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –∑–∞–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ 80, 443)
sudo netstat -tlnp | grep LISTEN

# Nginx –ª–æ–≥–∏ - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –Ω–µ–≥–æ
docker logs vitte_nginx --tail 20
```

---

### 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# Prometheus –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:9090/api/v1/targets

# Grafana (–±—Ä–∞—É–∑–µ—Ä)
# http://195.209.210.96:3000
# Login: admin / –í–ê–®_–ü–ê–†–û–õ–¨
```

---

### 10. –õ–æ–≥–∏ –±–æ—Ç–∞ - —Ä–µ–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –±–æ—Ç–∞
docker logs vitte_bot --tail 50

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# {"levelname": "INFO", "message": "Bot started successfully"}
# {"levelname": "INFO", "message": "New user registered: 123456"}
# {"levelname": "INFO", "message": "Command /start from user 123456"}
```

```bash
# Follow —Ä–µ–∂–∏–º (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
docker logs -f vitte_bot
```
